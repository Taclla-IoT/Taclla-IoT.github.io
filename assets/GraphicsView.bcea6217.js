import{A as F}from"./AlertMessage.40500fd0.js";import{S as M}from"./SearchField.2868fbb4.js";import{E as T}from"./ExportButton.1f5b7260.js";import{_ as w,o as u,c as d,e as a,t as m,m as g,F as h,f as _,g as k,r as y,j as x,v as C,h as b,d as E,a as v}from"./index.09c6df64.js";import{B}from"./BackendConnection.760cf3dc.js";const D={props:["model","quantity"],data(){return{chart:null,graphics:null}},methods:{getDate(e){if(e.data.years){let t=(e.data.days<9?"0"+e.data.days:e.data.days)+"/";return t+=(e.data.months<9?"0"+e.data.months:e.data.months)+"/",t+=e.data.years,t}else return e.created_at.slice(0,10)+" "+e.time_at},getColor(e){if(e=="temperature_mean_C")return"#ffa154";if(e=="temperature_dc")return"#ffa154";if(e=="temperature_max")return"#ed5353";if(e=="temperature_min")return"#64baff";if(e=="humidity_rh")return"#2980B9FF";if(e=="humidity_mean_1")return"#E67E22FF";if(e=="humidity_mean_2")return"#AF601AFF";if(e=="rain_mmh")return"#0d52bf";if(e=="light_lux")return"#FF00F0FF"},getScale(e,t){},generate(){const e=[],t={},i={},o=[];this.chart&&this.chart.destroy(),this.model.dynamo.sort((s,r)=>{const p=new Date(s.data.years,s.data.months-1,s.data.days,s.data.hours,s.data.minutes,s.data.seconds),f=new Date(r.data.years,r.data.months-1,r.data.days,r.data.hours,r.data.minutes,r.data.seconds);return p-f}),this.model.dynamo.forEach(s=>{e.push(this.getDate(s));for(const r in s.data)r=="temperature_mean_C"?i[r]="Temperatura promedio":r=="temperature_dc"?i[r]="Temperatura":r=="temperature_max"?i[r]="Temperatura m\xE1xima":r=="temperature_min"?i[r]="Temperatura m\xEDnima":r=="humidity_rh"?i[r]="Humedad relativa":r=="humidity_mean_1"?i[r]="Humedad a 15cm":r=="humidity_mean_2"?i[r]="Humedad a 45cm":r=="rain_mmh"?i[r]="Lluvia":r=="light_lux"&&(i[r]="Radiaci\xF3n"),i[r]&&(t[r]?t[r].push(s.data[r]):t[r]=[s.data[r]])});for(const s in i){const r=t[s].slice(-this.quantity),p=[];for(let c=0;c<r.length;c+=3)p.push(r[c]);const f=this.getColor(s);o.push({type:s=="rain_mmh"||s=="light_lux"?"bar":"line",label:i[s],data:p,backgroundColor:f,borderColor:f,fill:!1})}const n=e.slice(-this.quantity),l=[];for(let s=0;s<n.length;s+=3)l.push(n[s]);if(this.graphics={data:{labels:l,datasets:o},options:{legend:{display:!0}}},o.length){console.log(o);try{this.chart=new Chart("graphic",this.graphics)}catch(s){console.log(s)}}else{const r=document.getElementById("graphic").getContext("2d");r.font="21px Roboto Helvetica Neue",r.fillText("No hay datos para mostrar",15,50)}},getMonth(e){if(e==1)return"Enero";if(e==2)return"Febrero";if(e==3)return"Marzo";if(e==4)return"Abril";if(e==5)return"Mayo";if(e==6)return"Junio";if(e==7)return"Julio";if(e==8)return"Agosto";if(e==9)return"Septiembre";if(e==10)return"Octubre";if(e==11)return"Noviembre";if(e==12)return"Diciembre"}},computed:{getTempMax(){let e=0;return this.model.dynamo.map(t=>{t.data.temperature_mean_C&&e<t.data.temperature_mean_C&&(e=t.data.temperature_mean_C)}),e.toFixed(2)},getTempMin(){let e=1e3;return this.model.dynamo.map(t=>{t.data.temperature_mean_C&&e>t.data.temperature_mean_C&&t.data.temperature_mean_C>0&&(e=t.data.temperature_mean_C)}),e.toFixed(2)},getTempMean(){let e=21.1;return this.model.dynamo.map(t=>{t.data.temperature_mean_C&&(e=.5*(e+t.data.temperature_mean_C))}),e.toFixed(2)},getRadMean(){if(this.graphics){let e=0;return this.graphics.data.datasets.forEach(t=>{t.label=="Radiaci\xF3n"&&t.data.forEach(i=>{i>8e3&&(e+=1)})}),e.toFixed()}else return 0},getAccumulatedRain(){let e=0;return this.model.dynamo.map(t=>{t.data.rain_mmh&&t.data.years==2023&&(e+=t.data.rain_mmh/3)}),e.toFixed(2)},display(){const e={};this.model.dynamo.forEach(t=>{for(let i in t.data)i=="months"&&(e[t.data.months+"-"+t.data.years]={rain_mmh:0,temperature_mean_C:21.1,temperature_max:27.7,temperature_min:15.5,days:0})}),this.model.dynamo.forEach(t=>{const i=t.data.months+"-"+t.data.years;for(let o in t.data)o=="rain_mmh"?e[i][o]+=t.data[o]/3:o=="temperature_mean_C"||o=="temperature_max"||o=="temperature_min"?e[i][o]=.5*(e[i][o]+t.data[o]):o=="days"?e[i][o]+=1/3:o=="months"&&(e[i][o]=t.data[o])});for(let t in e)for(let i in e[t])i=="days"||i=="months"||i=="rain_mmh"?e[t][i]=e[t][i].toFixed():e[t][i]=e[t][i].toFixed(2);return e}},watch:{model(){this.generate()},quantity(){this.generate()}},mounted(){this.generate()}},N={class:"m-3 mx-auto"},A={class:"row mt-3 mx-auto"},S={id:"moduleTitle",class:"my-1"},q={class:"row mt-3 w-100 mx-auto"},V={class:"m-3 w-75 mx-auto"},G=a("td",null,[a("h4",null,"Temperatura m\xEDnima")],-1),R={class:"blue"},H=a("td",null,[a("h4",null,"Temperatura m\xE1xima")],-1),L={class:"red"},P=a("td",null,[a("h4",null,"Temperatura promedio")],-1),z=a("td",null,[a("h4",null,"Lluvia acumulada anual")],-1),J={class:"dblue"},U=a("div",{class:"row mt-2 w-100 mx-auto"},[a("canvas",{id:"graphic",class:"h-auto mx-auto my-3 p-1"})],-1),j={class:"row mt-2 w-75 mx-auto"},I={class:"table table-striped"},O=a("thead",null,[a("tr",{span:"10"},[a("h2",null,"Acumulados y niveles cr\xEDticos.")])],-1),K=a("th",{class:"col"},"Mes del a\xF1o",-1),Q={class:"col"},W=a("th",{class:"col"},"Lluvia acumulada mensual",-1),X={class:"col"},Y=a("th",{class:"col"},"Temperatura m\xE1xima promedio",-1),Z=a("th",{class:"col"},"Temperatura promedio",-1),$=a("th",{class:"col"},"Temperatura m\xEDnima promedio",-1);function ee(e,t,i,o,n,l){return u(),d("div",N,[a("div",A,[a("h1",S,[a("strong",null,m(this.model.sname),1)])]),a("div",q,[a("table",V,[a("tr",null,[G,a("td",null,[a("h4",R,m(l.getTempMin)+"\xB0C",1)])]),a("tr",null,[H,a("td",null,[a("h4",L,m(l.getTempMax)+"\xB0C",1)])]),a("tr",null,[P,a("td",null,[a("h4",{style:g({background:this.getScale(l.getTempMean,[18,22])})},m(l.getTempMean)+"\xB0C",5)])]),a("tr",null,[z,a("td",null,[a("h4",J,m(l.getAccumulatedRain)+" mm ",1)])])])]),U,a("div",j,[a("table",I,[O,a("tbody",null,[a("tr",null,[K,(u(!0),d(h,null,_(l.display,s=>(u(),d("td",Q,m(l.getMonth(s.months)),1))),256))]),a("tr",null,[W,(u(!0),d(h,null,_(l.display,s=>(u(),d("td",X,m(s.rain_mmh)+" mm ",1))),256))]),a("tr",null,[Y,(u(!0),d(h,null,_(l.display,s=>(u(),d("td",{class:"col",style:g({background:this.getScale(s.temperature_max,[18,30])})},m(s.temperature_max)+" \xB0C ",5))),256))]),a("tr",null,[Z,(u(!0),d(h,null,_(l.display,s=>(u(),d("td",{class:"col",style:g({background:this.getScale(s.temperature_mean_C,[18,22])})},m(s.temperature_mean_C)+" \xB0C ",5))),256))]),a("tr",null,[$,(u(!0),d(h,null,_(l.display,s=>(u(),d("td",{class:"col",style:g({background:this.getScale(s.temperature_min,[5,22])})},m(s.temperature_min)+" \xB0C ",5))),256))])])])])])}const te=w(D,[["render",ee]]);const ae={props:["token","user","hasPermission","updateToken"],data(){return{moduleName:"graphics",title:k.graphics.title,models:[],original:[],quantity:1092,place:""}},created(){this.token?this.user?this.hasPermission(this.moduleName,"access")||this.$router.push("/"):this.$router.push("/"):this.$router.push("/")},methods:{showMessage(e,t){this.$refs.AlertMessage.show(e,t)},searchData(e){this.models=e},async getData(){try{const e=await this.$refs.BackendConnection.getAll();this.original=e.data.filter(t=>t.sid!=="a288e65294e04082bd90c4b1e3eddb7b"),this.models=this.original,this.updateToken({...e,token:this.token}),this.models.length&&(this.place=this.models[0].pid)}catch(e){console.log(e),this.showMessage("No se pudo obtener los registros de la base de datos.","error")}},exportData(e=0){e==1?this.$refs.ExportButton.exportFile(this.original,this.moduleName):this.$refs.ExportButton.exportFile(this.models,this.moduleName)}},components:{AlertMessage:F,SearchField:M,ExportButton:T,GraphicController:te,BackendConnection:B},mounted(){this.hasPermission(this.moduleName,"access")?this.getData():this.$router.push("/")},watch:{place(){const e=[];this.original.length&&(this.original.forEach(t=>{t.pid==this.place&&e.push(t)}),this.searchData(e))}}},se={class:"row pt-3 w-100"},re={class:"col"},ie={id:"moduleTitle"},oe={class:"col py-2"},ne={class:"btn-group"},le=["value","selected"],ue=["selected"],de=["selected"],ce=["selected"],me=["selected"];function he(e,t,i,o,n,l){const s=y("ExportButton"),r=y("AlertMessage"),p=y("GraphicController"),f=y("BackendConnection");return u(),d(h,null,[a("div",se,[a("div",re,[a("h1",ie,m(n.title),1)]),a("div",oe,[a("div",ne,[x(a("select",{"onUpdate:modelValue":t[0]||(t[0]=c=>n.place=c),class:"rounded","data-toggle":"tooltip","data-placement":"bottom",title:"Selecciona un lugar",style:{"min-width":"200px"}},[(u(!0),d(h,null,_(n.original,c=>(u(),d("option",{value:c.pid,selected:n.place==c.pid},m(c.pname),9,le))),256))],512),[[C,n.place]]),x(a("select",{"onUpdate:modelValue":t[1]||(t[1]=c=>n.quantity=c),class:"rounded",style:{"min-width":"75px"}},[a("option",{value:"3",selected:n.quantity==3},"D\xEDa",8,ue),a("option",{value:"21",selected:n.quantity==21},"Semana",8,de),a("option",{value:"84",selected:n.quantity==84},"Mes",8,ce),a("option",{value:"1092",selected:n.quantity==1092},"A\xF1o",8,me)],512),[[C,n.quantity]]),i.hasPermission(n.moduleName,"export")?(u(),b(s,{key:0,ref:"ExportButton",onExportData:l.exportData},null,8,["onExportData"])):E("",!0)])])]),v(r,{ref:"AlertMessage",class:"row pt-1"},null,512),(u(!0),d(h,null,_(n.models,c=>(u(),b(p,{model:c,quantity:n.quantity,class:"my-1"},null,8,["model","quantity"]))),256)),v(f,{token:i.token,moduleName:n.moduleName,ref:"BackendConnection",onShowMessage:l.showMessage},null,8,["token","moduleName","onShowMessage"])],64)}const xe=w(ae,[["render",he]]);export{xe as default};
